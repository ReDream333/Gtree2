<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>–î–∏–∞–≥—Ä–∞–º–º–∞ –¥–µ—Ä–µ–≤–∞</title>
  <script src="https://unpkg.com/gojs"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.2"></script>
  <link rel="stylesheet" th:href="@{/css/treeDiagram.css}"/>
</head>
<body>

<button class="back-button" onclick="location.href='/profile/me'">–ù–∞–∑–∞–¥</button>

<div id="sample">
  <div id="myDiagramDiv"></div>
</div>

<div style="margin-top:20px; text-align:center;">
  <button id="zodiacStatsBtn">–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–Ω–∞–∫–æ–≤</button>
</div>

<div style="margin-top:10px; text-align:center;">
  <button id="subscribeBtn">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
</div>

<div id="controls" style="margin-top: 10px;">
  <div>
    <span id="selectedNodeInfo"></span>
  </div>
</div>



<div id="zodiacModal" class="modal" style="display:none;">
  <div class="modal-content" style="position:relative;">
    <button id="zodiacModalClose" style="position:absolute;top:5px;right:5px;">‚úñ</button>
    <canvas id="zodiacChart" width="300" height="300"></canvas>
    <p id="zodiacMessage"></p>
  </div>
</div>


<!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–æ–¥–µ -->
<div id="nodeInfoPanel">
  <button id="closePanelButton" style="float: right;">‚úñ</button>

  <!-- –§–æ—Ç–æ –∏ –∏–º—è -->
  <div style="display: flex; align-items: center;">
    <img id="nodeViewPhoto"
         th:src="@{/images/ava.jpg}"
         alt="–§–æ—Ç–æ"
         style="width: 100px; height: 100px; border-radius: 50%; margin-right: 10px;"/>
    <h2 id="nodeName">–ú–Ø–£</h2>
  </div>

  <!-- –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
  <div id="nodeViewMode">
    <p>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: <span id="nodeBirthDate">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span></p>
    <p>–î–∞—Ç–∞ —Å–º–µ—Ä—Ç–∏: <span id="nodeDeathDate">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span></p>
    <p>–ó–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞: <span id="nodeZodiac">-</span><span id="nodeZodiacIcon" class="zodiac-icon"></span></p>
    <p id="nodeComment"></p>

    <button id="editNodeButton">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
    <button id="biographyButton">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</button>
    <button id="photoAlbumButton">–§–æ—Ç–æ-–∞–ª—å–±–æ–º</button>
    <button id="addParentButton" disabled>–î–æ–±–∞–≤–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è</button>
    <button id="deleteNodeButton">–£–¥–∞–ª–∏—Ç—å</button>
    <button id="compatButton">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</button>
  </div>

  <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div id="nodeEditMode">
    <label>–§–∞–º–∏–ª–∏—è: <input type="text" id="editLastName"/></label><br/>
    <label>–ò–º—è: <input type="text" id="editFirstName"/></label><br/>
    <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: <input type="date" id="editBirthDate"/></label><br/>
    <label>–î–∞—Ç–∞ —Å–º–µ—Ä—Ç–∏: <input type="date" id="editDeathDate"/></label><br/>
    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:<br/>
      <textarea id="editComment" rows="3" style="width: 100%;"></textarea>
    </label><br/>

    <button id="upload_widget">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
    <button id="saveNodeButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button id="cancelEditButton">–û—Ç–º–µ–Ω–∞</button>
  </div>

  <!-- Cloudinary upload widget (–∫–∞–∫ –±—ã–ª–æ –≤ JSP) -->
  <script src="https://upload-widget.cloudinary.com/latest/global/all.js" type="text/javascript"></script>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è -->
<div id="parentModal">
  <div>
    <h3>–î–æ–±–∞–≤–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è</h3>
    <label>–ò–º—è: <input type="text" id="parentFirstName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"/></label><br/>
    <label>–§–∞–º–∏–ª–∏—è: <input type="text" id="parentLastName" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é"/></label><br/>
    <label>–ü–æ–ª:
      <select id="parentGender">
        <option value="M">–º—É–∂—Å–∫–æ–π</option>
        <option value="F">–∂–µ–Ω—Å–∫–∏–π</option>
      </select>
    </label><br/>
    <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: <input type="date" id="parentBirthDate"/></label><br/>
    <label>–î–∞—Ç–∞ —Å–º–µ—Ä—Ç–∏: <input type="date" id="parentDeathDate"/></label><br/>
    <label>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è:
      <textarea id="parentBiography" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –±–∏–æ–≥—Ä–∞—Ñ–∏—é"></textarea>
    </label><br/>

    <label id="errorMessage">
      –ò–º—è, —Ñ–∞–º–∏–ª–∏—è –∏ –ø–æ–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è.
    </label><br/>
    <button id="saveParentButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button id="cancelParentButton">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ–º -->
<div id="congratsModal" class="modal" style="display: none;">
  <div class="modal-content">
    <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ</h2>
    <p>–¢–æ–ª—å–∫–æ —á—Ç–æ –≤—ã –¥–æ–±–∞–≤–∏–ª–∏ —Å–∞–º—É—é –≥–ª–∞–≤–Ω—É—é –Ω–æ–¥—É ‚Äì <b>—Å–µ–±—è</b>.<br>
      –°–ª–µ–¥—É—é—â–∞—è –≤–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äì –≤–∑—Ä–∞—â–∏–≤–∞—Ç—å –¥–µ—Ä–µ–≤–æ.<br>
      –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏—Ö —Ä–æ–¥–∏—Ç–µ–ª–µ–π –∏ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤!
    </p>
    <button id="closeModalButton" class="modal-button">–ö—Ä—É—Ç–æ!</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ -->
<div id="compatModal" class="modal" style="display:none;">
  <div class="modal-content" style="position:relative;">
    <button id="compatModalClose" style="position:absolute;top:5px;right:5px;">‚úñ</button>
    <p id="compatResultText"></p>
  </div>
</div>

<div id="subscriptionModal" class="modal" style="display:none;">
  <div class="modal-content">
    <p id="subscriptionMessage"></p>
    <button id="subscriptionClose" class="modal-button">–û–∫</button>
  </div>
</div>
<script th:inline="javascript">
  /*<![CDATA[*/
  const nodesJsonString = /*[[${nodes}]]*/ '[]';
  const linksJsonString = /*[[${links}]]*/ '[]';

  let nodeDataArray, linkDataArray;
  try {
    nodeDataArray = JSON.parse(nodesJsonString);
  } catch(e) {
    console.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å nodesJsonString:", nodesJsonString, e);
    nodeDataArray = [];
  }
  try {
    linkDataArray = JSON.parse(linksJsonString);
  } catch(e) {
    console.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å linksJsonString:", linksJsonString, e);
    linkDataArray = [];
  }

  const treeId = /*[[${treeId}]]*/ 0;
  console.log("nodeDataArray:", nodeDataArray);
  console.log("linkDataArray:", linkDataArray);
  /*]]>*/
</script>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ JS‚Äê—Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ Thymeleaf-—Å—Å—ã–ª–∫–∏ -->
<script th:src="@{/js/congrats.js}"></script>
<script th:src="@{/js/treeDiagram.js}"></script> <!-- –°–æ–∑–¥–∞—ë—Ç –¥–∏–∞–≥—Ä–∞–º–º—É -->
<script th:src="@{/js/nodeInfo.js}"></script>    <!-- –î–æ–±–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–æ–¥ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:src="@{/js/zodiacStats.js}"></script>
<script th:src="@{/js/subscription.js}"></script>

</body>
</html>
